<!DOCTYPE html>
<html lang="en" class="hide-scrollbar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hand & Foot Ultimate Scorer | Pro Card Game Tracker</title>
    
    <meta name="description" content="Fully customizable Hand and Foot card game scorecard. Define custom book types, manage multiple teams, and track exact draw bonuses.">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#312e81">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_CLIENT_ID" crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        body { -webkit-tap-highlight-color: transparent; scroll-behavior: smooth; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .ad-padding { padding-bottom: 120px; }
        .prose h2 { font-weight: 900; font-style: italic; margin-top: 1.5rem; color: #4338ca; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem; }
        .animate-pop { animation: pop 0.2s ease-out; }
        @keyframes pop { 0% { transform: scale(0.98); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const getSaved = (key, fallback) => {
            const saved = localStorage.getItem(key);
            try { return saved ? JSON.parse(saved) : fallback; } catch (e) { return fallback; }
        };

        const App = () => {
            const [view, setView] = useState('game');
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [darkMode, setDarkMode] = useState(() => getSaved('hf_darkMode', false));
            
            // Standard point values
            const [pointValues, setPointValues] = useState(() => getSaved('hf_basePoints', { 
                clean: 500, dirty: 300, outBonus: 100, drawBonus: 100 
            }));

            // User-defined custom books (e.g., { name: 'Wilds', value: 1500 })
            const [customBooks, setCustomBooks] = useState(() => getSaved('hf_customBooks', [
                { id: 'b1', name: 'Wilds', value: 1500 },
                { id: 'b2', name: '7s', value: 2500 }
            ]));

            const [history, setHistory] = useState(() => getSaved('hf_history', []));
            const [winningTeamId, setWinningTeamId] = useState(null);
            
            // Teams store their specific counts for custom books in an object: { b1: 0, b2: 0 }
            const [teams, setTeams] = useState(() => getSaved('hf_teams', [
                { id: 1, name: 'Team 1', clean: 0, dirty: 0, cards: 0, draws: 0, customCounts: {} },
                { id: 2, name: 'Team 2', clean: 0, dirty: 0, cards: 0, draws: 0, customCounts: {} },
            ]));

            useEffect(() => {
                localStorage.setItem('hf_darkMode', JSON.stringify(darkMode));
                localStorage.setItem('hf_history', JSON.stringify(history));
                localStorage.setItem('hf_teams', JSON.stringify(teams));
                localStorage.setItem('hf_basePoints', JSON.stringify(pointValues));
                localStorage.setItem('hf_customBooks', JSON.stringify(customBooks));
                document.documentElement.classList.toggle('dark', darkMode);
            }, [darkMode, history, teams, pointValues, customBooks]);

            const updateTeamCount = (count) => {
                const newCount = Math.max(2, Math.min(5, count));
                if (newCount > teams.length) {
                    const added = [];
                    for (let i = teams.length + 1; i <= newCount; i++) {
                        added.push({ id: i, name: `Team ${i}`, clean: 0, dirty: 0, cards: 0, draws: 0, customCounts: {} });
                    }
                    setTeams([...teams, ...added]);
                } else if (newCount < teams.length) {
                    if (confirm("Delete the last team's data?")) setTeams(teams.slice(0, newCount));
                }
            };

            const addCustomBook = () => {
                const name = prompt("Enter Book Name (e.g., 'Aces'):");
                const value = parseInt(prompt("Enter Point Value:"));
                if (name && !isNaN(value)) {
                    setCustomBooks([...customBooks, { id: 'b' + Date.now(), name, value }]);
                }
            };

            const removeCustomBook = (id) => {
                if(confirm("Remove this book type from all teams?")) {
                    setCustomBooks(customBooks.filter(b => b.id !== id));
                }
            };

            const updateTeamVal = (idx, key, val) => {
                const nt = [...teams];
                nt[idx][key] = val;
                setTeams(nt);
            };

            const updateCustomCount = (teamIdx, bookId, val) => {
                const nt = [...teams];
                nt[teamIdx].customCounts = { ...nt[teamIdx].customCounts, [bookId]: val };
                setTeams(nt);
            };

            const calculateTeamRound = (team) => {
                let score = (Number(team.clean) * pointValues.clean) + 
                            (Number(team.dirty) * pointValues.dirty) + 
                            (Number(team.cards) || 0) +
                            (team.draws * pointValues.drawBonus);
                
                // Add scores from custom books
                customBooks.forEach(book => {
                    const count = team.customCounts[book.id] || 0;
                    score += (Number(count) * book.value);
                });

                if (winningTeamId === team.id) score += pointValues.outBonus;
                return score;
            };

            const getGrandTotal = (teamName) => {
                return history.reduce((sum, round) => {
                    const teamData = round.data.find(d => d.name === teamName);
                    return sum + (teamData ? teamData.score : 0);
                }, 0);
            };

            const saveRound = () => {
                const roundData = teams.map(t => ({ name: t.name, score: calculateTeamRound(t) }));
                setHistory([...history, { round: history.length + 1, data: roundData }]);
                setTeams(teams.map(t => ({ ...t, clean: 0, dirty: 0, cards: 0, draws: 0, customCounts: {} })));
                setWinningTeamId(null);
                window.scrollTo(0,0);
            };

            return (
                <div className="min-h-screen flex flex-col font-sans ad-padding">
                    <header className="bg-indigo-900 text-white p-5 flex justify-between items-center sticky top-0 z-50 shadow-md">
                        <button onClick={() => setIsMenuOpen(true)} className="text-2xl p-2">‚ò∞</button>
                        <h1 className="font-black italic text-xs tracking-[0.3em] cursor-pointer" onClick={() => setView('game')}>HAND & FOOT</h1>
                        <button onClick={() => setView('history')} className="p-2 text-xl">üìä</button>
                    </header>

                    {isMenuOpen && (
                        <div className="fixed inset-0 z-[100] flex">
                            <div className="bg-white dark:bg-slate-900 w-72 h-full shadow-2xl p-8 flex flex-col space-y-6 overflow-y-auto">
                                <button onClick={() => setIsMenuOpen(false)} className="text-slate-400 font-black text-left uppercase text-[10px]">‚úï Close</button>
                                <nav className="flex flex-col space-y-5 font-black text-lg dark:text-white italic text-left">
                                    <button onClick={() => { setView('game'); setIsMenuOpen(false); }}>üéÆ SCORER</button>
                                    <button onClick={() => { setView('history'); setIsMenuOpen(false); }}>üìä HISTORY</button>
                                    <button onClick={() => { setView('rules'); setIsMenuOpen(false); }}>üìú RULES</button>
                                    <button onClick={() => { setView('settings'); setIsMenuOpen(false); }}>‚öôÔ∏è SETTINGS</button>
                                </nav>
                            </div>
                            <div className="flex-1 bg-black/60 backdrop-blur-sm" onClick={() => setIsMenuOpen(false)}></div>
                        </div>
                    )}

                    <main className="flex-1 max-w-lg mx-auto w-full p-4">
                        {view === 'game' && (
                            <div className="space-y-4 animate-pop">
                                <div className="bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-md border-b-4 border-indigo-500">
                                    <h2 className="text-[10px] font-black text-slate-400 uppercase mb-3 text-center tracking-widest text-left px-2">Global Standings</h2>
                                    {teams.map(t => (
                                        <div key={t.id} className="flex justify-between items-center mb-2 border-b border-slate-50 dark:border-slate-700 pb-1 px-2">
                                            <span className="dark:text-white font-bold">{t.name}</span>
                                            <div className="font-black text-indigo-600 dark:text-indigo-400 text-lg">{getGrandTotal(t.name).toLocaleString()}</div>
                                        </div>
                                    ))}
                                </div>

                                {teams.map((team, idx) => (
                                    <div key={team.id} className="bg-white dark:bg-slate-800 p-4 rounded-2xl border dark:border-slate-700 shadow-sm space-y-4">
                                        <div className="flex justify-between items-center">
                                            <input className="bg-transparent font-black text-slate-800 dark:text-white w-1/3 outline-none" value={team.name} onChange={(e) => updateTeamVal(idx, 'name', e.target.value)} />
                                            <div className="flex gap-1 items-center">
                                                <span className="text-[8px] font-bold text-slate-400 uppercase italic mr-1">Draws</span>
                                                {[1, 2].map(num => (
                                                    <button key={num} onClick={() => updateTeamVal(idx, 'draws', team.draws === num ? 0 : num)} 
                                                        className={`w-7 h-7 rounded-full text-[10px] font-black ${team.draws >= num ? 'bg-indigo-500 text-white' : 'bg-slate-100 dark:bg-slate-700 text-slate-400'}`}>
                                                        {num}
                                                    </button>
                                                ))}
                                                <button onClick={() => setWinningTeamId(team.id === winningTeamId ? null : team.id)} className={`ml-2 px-3 py-1.5 rounded-full text-[9px] font-black ${winningTeamId === team.id ? 'bg-green-500 text-white shadow-lg' : 'bg-slate-100 dark:bg-slate-700 text-slate-400'}`}>OUT</button>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-400 uppercase italic px-1">Clean ({pointValues.clean})</label>
                                                <input type="number" inputMode="numeric" className="w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 dark:text-white outline-none focus:ring-2 ring-indigo-500" value={team.clean || ''} onChange={(e) => updateTeamVal(idx, 'clean', e.target.value)} placeholder="0" />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-400 uppercase italic px-1">Dirty ({pointValues.dirty})</label>
                                                <input type="number" inputMode="numeric" className="w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 dark:text-white outline-none focus:ring-2 ring-indigo-500" value={team.dirty || ''} onChange={(e) => updateTeamVal(idx, 'dirty', e.target.value)} placeholder="0" />
                                            </div>
                                            
                                            {/* Dynamic Custom Book Inputs */}
                                            {customBooks.map(book => (
                                                <div key={book.id} className="space-y-1">
                                                    <label className="text-[9px] font-bold text-slate-400 uppercase italic px-1 truncate block">{book.name} ({book.value})</label>
                                                    <input type="number" inputMode="numeric" className="w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 dark:text-white outline-none focus:ring-2 ring-indigo-500 border border-indigo-500/10" 
                                                        value={team.customCounts[book.id] || ''} 
                                                        onChange={(e) => updateCustomCount(idx, book.id, e.target.value)} placeholder="0" />
                                                </div>
                                            ))}

                                            <div className="space-y-1 col-span-2">
                                                <label className="text-[9px] font-bold text-slate-400 uppercase italic px-1">Total Face Value Points</label>
                                                <input type="number" inputMode="numeric" className="w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 dark:text-white outline-none focus:ring-2 ring-indigo-500" value={team.cards || ''} onChange={(e) => updateTeamVal(idx, 'cards', e.target.value)} placeholder="0" />
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                <button onClick={saveRound} className="w-full bg-indigo-600 text-white font-black py-5 rounded-2xl shadow-xl active:scale-95 transition-transform uppercase tracking-widest text-sm">Save Round {history.length + 1}</button>
                            </div>
                        )}

                        {view === 'settings' && (
                            <div className="space-y-6 dark:text-white animate-pop text-left">
                                <h2 className="text-xl font-black italic uppercase">Settings</h2>
                                
                                <div className="bg-white dark:bg-slate-800 p-5 rounded-2xl space-y-6 shadow-md">
                                    {/* Core Bonuses */}
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="space-y-1">
                                            <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Exact Draw</label>
                                            <input type="number" className="w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 font-black text-indigo-500 border dark:border-slate-700" 
                                                value={pointValues.drawBonus} onChange={(e) => setPointValues({...pointValues, drawBonus: parseInt(e.target.value) || 0})} />
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Out Bonus</label>
                                            <input type="number" className="w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 font-black text-indigo-500 border dark:border-slate-700" 
                                                value={pointValues.outBonus} onChange={(e) => setPointValues({...pointValues, outBonus: parseInt(e.target.value) || 0})} />
                                        </div>
                                    </div>

                                    {/* Dynamic Custom Books Manager */}
                                    <div className="border-t dark:border-slate-700 pt-4">
                                        <div className="flex justify-between items-center mb-4">
                                            <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Manage Book Types</label>
                                            <button onClick={addCustomBook} className="bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 px-3 py-1 rounded-full text-[10px] font-black">+ ADD BOOK</button>
                                        </div>
                                        <div className="space-y-2">
                                            {customBooks.map(book => (
                                                <div key={book.id} className="flex items-center justify-between bg-slate-50 dark:bg-slate-900 p-3 rounded-xl border dark:border-slate-700">
                                                    <div>
                                                        <div className="font-black text-sm">{book.name}</div>
                                                        <div className="text-[10px] text-slate-400 uppercase font-bold">{book.value} Points</div>
                                                    </div>
                                                    <button onClick={() => removeCustomBook(book.id)} className="text-red-500 p-2">‚úï</button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div className="flex justify-between items-center border-t dark:border-slate-700 pt-4">
                                        <label className="font-bold text-xs uppercase text-slate-500 tracking-widest">Active Teams</label>
                                        <div className="flex items-center gap-4 bg-slate-100 dark:bg-slate-900 rounded-xl p-1">
                                            <button onClick={() => updateTeamCount(teams.length - 1)} className="w-10 h-10 font-black text-indigo-500">-</button>
                                            <span className="font-black">{teams.length}</span>
                                            <button onClick={() => updateTeamCount(teams.length + 1)} className="w-10 h-10 font-black text-indigo-500">+</button>
                                        </div>
                                    </div>
                                    <button onClick={() => setDarkMode(!darkMode)} className="w-full py-3 bg-indigo-500 text-white rounded-xl font-bold uppercase text-xs tracking-widest shadow-lg">Toggle {darkMode ? 'Light' : 'Dark'} Mode</button>
                                </div>
                                <button onClick={() => { if(confirm("Erase all data?")) { setHistory([]); setView('game'); } }} className="w-full py-4 text-red-500 border-2 border-red-500/10 rounded-2xl font-black text-xs uppercase tracking-widest">Reset All Data</button>
                            </div>
                        )}

                        {view === 'rules' && (
                            <div className="prose dark:text-slate-300 pb-10 animate-pop text-left">
                                <h1 className="text-3xl font-black italic dark:text-white mb-6">Hand & Foot Rules</h1>
                                
                                <p>Hand and Foot is a variant of Canasta played with multiple decks. It involves strategic melds and "going out" only after clearing both your Hand and Foot stacks.</p>
                                <h2>Custom Scoring</h2>
                                <p>Our Ultimate Scorer allows you to define your own house rules. Whether you play with high-value <strong>Wild Books</strong>, <strong>7s Books</strong>, or unique bonuses for <strong>Aces</strong>, you can configure them in the Settings tab.</p>
                                <h2>Exact Draw</h2>
                                <p>Earn bonus points for drawing exactly 13 cards for your Hand and 11 cards for your Foot in one go. Toggle these using the circle buttons next to each team name.</p>
                                <button onClick={() => setView('game')} className="w-full py-4 mt-6 bg-indigo-600 text-white rounded-xl font-bold">Back to Scorer</button>
                            </div>
                        )}

                        {view === 'history' && (
                            <div className="space-y-4 animate-pop">
                                <h2 className="text-xl font-black italic dark:text-white uppercase tracking-tighter text-left">Round History</h2>
                                {history.length === 0 ? (
                                    <div className="text-center py-20 text-slate-400 italic border-2 border-dashed rounded-2xl dark:border-slate-700">No rounds recorded yet.</div>
                                ) : (
                                    history.map((h, i) => (
                                        <div key={i} className="bg-white dark:bg-slate-800 p-4 rounded-2xl border dark:border-slate-700 shadow-sm">
                                            <div className="text-[10px] font-black text-indigo-500 uppercase mb-2">Round {h.round}</div>
                                            {h.data.map((d, idx) => (
                                                <div key={idx} className="flex justify-between text-sm py-1 border-b border-slate-50 dark:border-slate-700 last:border-0">
                                                    <span className="dark:text-slate-300 font-bold">{d.name}</span>
                                                    <span className="font-black dark:text-white">{d.score.toLocaleString()}</span>
                                                </div>
                                            ))}
                                        </div>
                                    )).reverse()
                                )}
                            </div>
                        )}
                    </main>

                    <div className="fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-slate-900 border-t dark:border-slate-800 min-h-[60px] flex items-center justify-center">
                        <ins className="adsbygoogle"
                             style={{ display: 'block', width: '100%' }}
                             data-ad-client="ca-pub-YOUR_CLIENT_ID"
                             data-ad-slot="YOUR_AD_SLOT"
                             data-ad-format="horizontal"
                             data-full-width-responsive="true"></ins>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
